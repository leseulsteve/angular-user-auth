"use strict";angular.module("leseulsteve.angular-user-auth",["ngAnimate"]),angular.module("leseulsteve.angular-user-auth").config(["$httpProvider",function(a){a.interceptors.push(["$q","$window","$rootScope",function(a,b,c){return{request:function(a){a.headers=a.headers||{};var c=b.localStorage.getItem("token");return c&&(a.headers.Authorization="Bearer "+c),a},responseError:function(b){switch(b.status){case 401:c.$broadcast("UserAuth:request:unauthorized",b)}return a.reject(b)}}}])}]),angular.module("leseulsteve.angular-user-auth").run(["$rootScope","$state","$window","UserAuth",function(a,b,c,d){function e(){a.currentUser={},a.currentUser.isAuthentified=function(){return!1},c.localStorage.removeItem("token"),c.localStorage.removeItem("token-expiration"),c.localStorage.removeItem("user"),b.go(f.loginStateName)}var f=d.config;a.currentUser=d.getCurrentUser(),a.currentUser||e(),a.$on("$stateChangeStart",function(b,c){a.currentUser.isAuthentified()||_.includes(f.authorizedRoutes,c.name)||c.name===f.loginStateName||(b.preventDefault(),e())}),a.$on("UserAuth:request:unauthorized",function(){e()})}]),angular.module("leseulsteve.angular-user-auth").directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(a,b,c,d){a.$watch(function(){var b;return(a.passwordVerify||d.$viewValue)&&(b=a.passwordVerify+"_"+d.$viewValue),b},function(b){b&&d.$parsers.unshift(function(b){var c=a.passwordVerify;return c!==b?void d.$setValidity("passwordVerify",!1):(d.$setValidity("passwordVerify",!0),b)})})}}}),angular.module("leseulsteve.angular-user-auth").directive("signinForm",["$animate","UserAuth",function(a,b){return{restrict:"A",link:function(c,d){c.signin=function(c,e){c.$invalid&&b.config.signinForm&&b.config.signinForm.animate&&a.addClass(d,"shake").then(function(){a.removeClass(d,"shake")}),c.$valid&&b.signin(e)},c.sendPasswordToken=function(a){b.sendPasswordToken(a)}}}}]),angular.module("leseulsteve.angular-user-auth").directive("signupForm",["UserAuth",function(a){return{restrict:"A",link:function(b){b.signup=function(b,c){b.$valid&&a.signup(c)}}}}]),angular.module("leseulsteve.angular-user-auth").provider("UserAuth",function(){var a={};return{config:function(b){_.extend(a,b)},$get:["$http","$location","$window","$rootScope","$injector",function(b,c,d,e,f){function g(a,b){return b.then(function(b){return e.$broadcast("UserAuth:"+a+":success",b.data),b.data}).catch(function(b){return e.$broadcast("UserAuth:"+a+":fail",b.data),b.data})}function h(a){if(a)d.localStorage.setItem("token",a.data.token.id),d.localStorage.setItem("token-expiration",a.data.token.expiration);else{var b=c.search().token;d.localStorage.setItem("token",b)}}function i(a){e.currentUser=a,d.localStorage.setItem("user",JSON.stringify(a))}var j={signin:"signin",signout:"signout",sendPasswordToken:"send_password_token",changePassword:"change_passport",signup:"signup",confirmEmail:"confirm_email"};_.forOwn(j,function(b,c){j[c]=(a.apiRoot||"")+"auth/"+b});var k=f.get(a.userSchema);return k.prototype.isAuthentified=function(){return null!==d.localStorage.getItem("token")&&new Date(d.localStorage.getItem("token-expiration"))>new Date},k.post("save",function(a){i(this),a()}),{config:a,signin:function(a){return b.post(j.signin,a).then(function(a){h(a);var b=new k(a.data.user);i(b),e.$broadcast("UserAuth:signin:success",b)}).catch(function(a){e.$broadcast("UserAuth:signin:fail",a.data)})},signout:function(){return g("signout",b.post(j.signout)).then(function(){d.localStorage.removeItem("token-expiration"),d.localStorage.removeItem("token"),d.localStorage.removeItem("user"),e.currentUser={},e.currentUser.isAuthentified=function(){return!1}})},sendPasswordToken:function(c){return g("sendPasswordToken",b.post(j.sendPasswordToken,{username:c,urlRedirection:a.sendPasswordToken.urlRedirection}))},changePassword:function(a){return h(),g("changePassword",b.post(j.changePassword,{newPassword:a}))},signup:function(c){return g("signup",b.post(j.signup,{newUser:c,urlRedirection:a.confirmEmail.urlRedirection}))},confirmEmail:function(){return h(),g("confirmEmail",b.post(j.confirmEmail))},getCurrentUser:function(){var a=d.localStorage.getItem("user");return a?new k(JSON.parse(a)):void 0}}}]}});
//# sourceMappingURL=angular-user-auth.min.js.map